#!/bin/bash

LOGFILE="EDITME"

echo "Kippo Summary"
echo
echo -n "Total sessions: "
grep "session: " ${LOGFILE} | wc -l

echo -n "Successful logins: "
grep "login attempt" ${LOGFILE} | grep succeeded | wc -l
echo

echo "Username and Password Combinartions"
echo "--------------------------"
grep succeeded ${LOGFILE} | awk -F" " '{print $9}'
echo

echo "Username and frequency: "
echo "--------------------------"
grep "authenticated with" ${LOGFILE} | awk -F" "  '{print $7}' | sort | uniq > /tmp/users
grep "authenticated with" ${LOGFILE} > /tmp/sessions
for x in `cat /tmp/users` 
 do echo -n "$x: " 
  grep $x /tmp/sessions | wc -l 
done
rm /tmp/users /tmp/sessions
echo

echo "Actual interactive sessions"
echo "--------------------------"
grep "Opening TTY log" ${LOGFILE} | awk -F"," '{ print $3 }' | awk -F"]" '{ print $1 }' > /tmp/sessip
for x in `cat /tmp/sessip` 
 do echo -n "$x: " 
  grep $x ${LOGFILE} | grep "Opening TTY log" | awk -F":" '{ print $4 }' 
done
rm /tmp/sessip
echo

echo "Downloaded files"
echo "--------------------------"
echo
grep "Starting factory <HTT" log/kippo.log | awk -F"," '{ print $3 }' | awk -F"]" '{ print $1 }' > /tmp/dlip
for x in `cat /tmp/dlip`
 do 
  echo -n "$x: "
  grep $x ${LOGFILE} | grep "Starting factory <HTT" | awk -F" " '{ print $14 }' | awk -F">" '{ print $1 }'
done
rm /tmp/dlip
echo
