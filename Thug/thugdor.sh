#!/bin/bash
# Master script for Thugdor
set -o nounset
set -o errexit

# CONFIGURATION
#
# OUTPUT DIRECTORIES
HOMEDIR="/home/matt"
REPORTDIR="${HOMEDIR}/MalwareReports"
THUGREPORTS="${REPORTDIR}/Thug"
EYEWITNESS="${REPORTDIR}/Eyewitness"
URLLIST="${HOMEDIR}/MalwareReports/malware-checks.txt"
URLDUMPS="${REPORTDIR}/url_dumps"
TMPTHUGREPORTS="/tmp/thug-reports-$$.txt"
# SCRIPTS AND TOOLS
PYTHON="/usr/bin/python"
URLDUMPER="${HOMEDIR}/Github/Malware/Thug/url-dumper.py"
THUGPARSE="${HOMEDIR}/Github/Malware/Thug/thug-parse.py"
EYEWITNESS="${HOMEDIR}/Github/EyeWitness/EyeWitness.py"
THUG="/opt/tools/thug/src/thug.py"


echo "Thugdor v0.1"
echo
echo -n "Running URL Dump script for Thug analysis"
test -d ${URLDUMPS} && true || mkdir -p ${URLDUMPS} 
${PYTHON} ${URLDUMPER} -f ${URLLIST} -d ${URLDUMPS}
echo "...ok"
echo 

echo -n "Running Thug on local files"
for URL in ${URLDUMPS}/*
    do 
	${PYTHON} ${THUG} -l ${URL} -n ${THUGREPORTS}
done

echo "...ok"
echo 

echo -n "Running Thug parsing script on Thug reports"

echo "...ok"
echo

echo -n "Running Eyewitness on any malicious links found"

echo "...ok"
echo

echo "We're done here"
rm -f ${TMPTHUGREPORTS} > /dev/null 2>&1
